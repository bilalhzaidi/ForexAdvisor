<script defer>
  async function submitForexTrade(e) {
    e.preventDefault();
    const form = e.target;
    const data = {
      pair: form.pair.value,
      timeframe: form.timeframe.value || "",
      comment: form.comment.value || ""
    };

    document.getElementById('response').innerHTML = '<div class="text-blue-600">Evaluating...</div>';

    try {
      const res = await fetch("https://bilalz.app.n8n.cloud/webhook/forex-gpt", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();

      if (result.error) {
        document.getElementById('response').innerHTML = `<p class='text-red-500'>${result.error}</p>`;
      } else {
        document.getElementById('response').innerHTML = `
          <div class='space-y-2 text-sm'>
            <p><strong>Decision:</strong> ${result.recommendation}</p>
            <p><strong>Trend:</strong> ${result.trend}</p>
            <p><strong>Confidence:</strong> ${result.confidence_score}</p>
            <p><strong>Adjustment:</strong> ${result.adjustments}</p>
            <p><strong>Reward:Risk:</strong> ${result.reward_to_risk}</p>
            <p><strong>Summary:</strong> <br><span class="whitespace-pre-line">${result.reasoning}</span></p>
          </div>`;
      }
    } catch (err) {
      document.getElementById('response').innerHTML = `<p class='text-red-500'>Failed to fetch advisory. Please check connection.</p>`;
    }
  }
</script>
